# 수출액 KPI 증감률(%) 계산식

## 현재 구현 상태

### 현재 코드 로직 (임시)
```typescript
// 현재 기간 평균값
averageRevenue = 전체 데이터의 평균값

// 이전 기간 평균값 (임시 로직)
previousPeriodAverage = 현재 데이터의 앞쪽 절반 평균값

// 증감률
revenueChange = ((averageRevenue - previousPeriodAverage) / previousPeriodAverage) × 100
```

**문제점**: 현재는 더미 데이터의 앞쪽 절반과 비교하고 있어, 실제 이전 기간과의 비교가 아닙니다.

---

## 케이스별 계산식 (권장)

### 1. 일간 (Daily) 필터
**데이터 범위**: Mon, Tue, Wed, Thu, Fri, Sat, Sun (7일)

**계산식**:
```
현재 주 평균 = (Mon + Tue + Wed + Thu + Fri + Sat + Sun) / 7
이전 주 평균 = (이전 주 Mon + 이전 주 Tue + ... + 이전 주 Sun) / 7
증감률 = ((현재 주 평균 - 이전 주 평균) / 이전 주 평균) × 100
```

**예시**:
- 이전 주 평균: ₩8,000,000
- 현재 주 평균: ₩8,800,000
- 증감률: ((8,800,000 - 8,000,000) / 8,000,000) × 100 = **+10.00%**

---

### 2. 주간 (Weekly) 필터
**데이터 범위**: W1, W2, W3, W4, W5, W6, W7, W8 (8주)

**계산식**:
```
현재 8주 평균 = (W1 + W2 + W3 + W4 + W5 + W6 + W7 + W8) / 8
이전 8주 평균 = (W-7 + W-6 + W-5 + W-4 + W-3 + W-2 + W-1 + W0) / 8
증감률 = ((현재 8주 평균 - 이전 8주 평균) / 이전 8주 평균) × 100
```

**예시**:
- 이전 8주 평균: ₩7,500,000
- 현재 8주 평균: ₩8,320,000
- 증감률: ((8,320,000 - 7,500,000) / 7,500,000) × 100 = **+10.93%**

**참고**: Rolling window 방식으로 최근 8주를 비교

---

### 3. 월간 (Monthly) 필터
**데이터 범위**: Jan, Feb, Mar, Apr, May, Jun, Jul, Aug, Sep, Oct, Nov, Dec (12개월)

**계산식**:
```
현재 연도 평균 = (Jan + Feb + Mar + ... + Dec) / 12
이전 연도 평균 = (작년 Jan + 작년 Feb + ... + 작년 Dec) / 12
증감률 = ((현재 연도 평균 - 이전 연도 평균) / 이전 연도 평균) × 100
```

**예시**:
- 작년 월평균: ₩7,200,000
- 올해 월평균: ₩8,000,000
- 증감률: ((8,000,000 - 7,200,000) / 7,200,000) × 100 = **+11.11%**

---

### 4. 연간 (Yearly) 필터
**데이터 범위**: Y1, Y2, Y3, Y4, Y5 (5년)

**계산식**:
```
현재 5년 평균 = (Y1 + Y2 + Y3 + Y4 + Y5) / 5
이전 5년 평균 = (Y-4 + Y-3 + Y-2 + Y-1 + Y0) / 5
증감률 = ((현재 5년 평균 - 이전 5년 평균) / 이전 5년 평균) × 100
```

**예시**:
- 이전 5년 평균: ₩6,500,000
- 현재 5년 평균: ₩7,800,000
- 증감률: ((7,800,000 - 6,500,000) / 6,500,000) × 100 = **+20.00%**

---

## 공통 공식

### 기본 공식
```
증감률(%) = ((현재 기간 평균값 - 이전 기간 평균값) / 이전 기간 평균값) × 100
```

### 소수점 처리
- 계산 결과를 소수점 두 자리까지 표시
- `Math.round(value * 100) / 100` 또는 `value.toFixed(2)`

### 예외 처리
- 이전 기간 평균값이 0이거나 없는 경우: 증감률 = 0%
- 현재 기간 데이터가 없는 경우: 증감률 표시 안 함

---

## 구현 시 고려사항

### 1. 데이터 조회
- 각 필터별로 해당 기간의 수출액 데이터를 조회
- 이전 기간 데이터도 함께 조회 필요

### 2. 날짜 계산
- **일간**: 현재 주 vs 이전 주
- **주간**: 최근 8주 vs 그 이전 8주 (rolling window)
- **월간**: 올해 12개월 vs 작년 12개월
- **연간**: 최근 5년 vs 그 이전 5년

### 3. 평균값 계산
- 각 기간의 모든 데이터 포인트를 합산 후 개수로 나눔
- 빈 데이터가 있어도 계산 가능하도록 처리

---

## 현재 코드 개선 방향

```typescript
// 개선된 로직 예시
const calculateRevenueChange = (currentData: RevenueData[], previousData: RevenueData[]) => {
  const currentAvg = currentData.reduce((sum, item) => sum + item.value, 0) / currentData.length;
  const previousAvg = previousData.reduce((sum, item) => sum + item.value, 0) / previousData.length;
  
  if (previousAvg === 0) return 0;
  
  return Math.round(((currentAvg - previousAvg) / previousAvg) * 100 * 100) / 100;
};
```

각 필터별로:
- 현재 기간 데이터와 이전 기간 데이터를 분리하여 조회
- 각각의 평균값을 계산
- 위 공식으로 증감률 계산
