# FarmMate 작업 등록 기능 PRD (Product Requirements Document)

## 📋 개요
FarmMate 어플리케이션의 작업 등록 기능에 대한 종합적인 제품 요구사항 문서입니다. TodoList 형태의 작업 등록부터 홈 메뉴바 연동, 영농일지 통합 관리까지의 전체 플로우를 정의합니다.

---

## 🎯 핵심 목표
- **TodoList 형태의 직관적인 작업 등록** 시스템 구축
- **홈 메뉴바와 캘린더를 통한 통합 관리** 환경 제공
- **영농일지와의 완전한 연동**으로 농업 활동 추적 최적화
- **Supabase 기반 클라우드 저장**으로 사용자별 보안 데이터 관리

---

## 🏗️ Phase 1: 기본 작업 등록 시스템 (완료 ✅)

### 1.1 기본 작업 등록 폼
- [x] **작업 제목 입력** - 사용자 정의 작업명 설정
- [x] **작업 유형 선택** - 파종, 정식, 수확 등 농업 작업 카테고리
- [x] **날짜 선택** - 작업 예정일 설정 (단일 날짜)
- [x] **농장/작물 연동** - 기존 농장 및 작물 데이터와 연결
- [x] **메모 기능** - 작업에 대한 추가 설명 입력
- [x] **폼 검증** - 필수 필드 유효성 검사

### 1.2 데이터 저장 시스템
- [x] **Supabase 연동** - tasks_v1 테이블을 통한 클라우드 데이터베이스 저장
- [x] **사용자별 데이터 분리** - RLS(Row Level Security) 적용
- [x] **Google 계정 연동** - 인증된 사용자만 데이터 접근
- [x] **자동 타임스탬프** - 생성일/수정일 자동 기록

### 1.3 작업 등록 모드
- [x] **단건 등록** - 하나의 작업을 특정 날짜에 등록
- [x] **일괄 등록** - 여러 작업을 시작 날짜에 한번에 등록
- [x] **개별 등록** - 하나의 작업을 날짜 범위에 걸쳐 등록
- [x] **작물명 일관성** - 모든 등록 방식에서 동일한 작물명 형식 사용
- [x] **제목 자동 생성** - 작물명_작업타입 형식으로 자동 제목 생성
- [x] **작물 정보 백업** - 등록 과정에서 작물 정보 손실 방지

---

## 🔄 Phase 2: 작업 관리 및 편집 시스템 (완료 ✅)

### 2.1 작업 수정 기능
- [x] **작업 정보 편집** - 제목, 날짜, 메모 등 모든 필드 수정 가능
- [x] **농장/작물 재연결** - 다른 농장이나 작물로 변경
- [x] **이랑 번호 관리** - 환경별 이랑 수에 따른 작업 범위 설정
- [x] **실시간 저장** - 수정사항 즉시 데이터베이스 반영
- [x] **수정 모드 초기화 개선** - 등록된 농장, 작물, 이랑 번호가 올바르게 표시
- [x] **작물명 자동 추출** - 제목에서 작물명을 자동으로 추출하여 표시
- [x] **데이터 타입 호환성** - farmId와 cropId의 UUID 문자열 처리 개선

### 2.2 작업 삭제 기능
- [x] **안전한 삭제** - 확인 다이얼로그를 통한 실수 방지
- [x] **완전 삭제** - 데이터베이스에서 영구 제거
- [x] **UI 즉시 반영** - 삭제 후 화면 자동 업데이트

### 2.3 작업 상태 관리
- [x] **완료 상태 토글** - 작업 완료/미완료 상태 변경
- [x] **완료 시간 기록** - 작업 완료 시점 자동 저장
- [x] **시각적 표시** - 완료된 작업과 미완료 작업 구분 표시

---

## 📅 Phase 3: 홈 메뉴바 통합 시스템 (완료 ✅)

### 3.1 캘린더 뷰 통합
- [x] **월별 캘린더** - 월 단위로 작업 일정 표시
- [x] **날짜별 작업 표시** - 각 날짜에 등록된 작업 수 표시
- [x] **작업 상세 미리보기** - 날짜 클릭 시 해당 날짜 작업 목록 표시
- [x] **오늘 날짜 하이라이트** - 현재 날짜 강조 표시

### 3.2 홈 화면 작업 목록
- [x] **선택된 날짜 작업 표시** - 클릭한 날짜의 모든 작업 나열
- [x] **작업 아이콘 표시** - 작업 유형별 시각적 아이콘
- [x] **작업 우선순위 색상** - 중요도에 따른 색상 구분
- [x] **빈 상태 처리** - 작업이 없는 날짜에 대한 안내 메시지

### 3.3 빠른 작업 추가
- [x] **+ 버튼 클릭** - 홈 화면에서 바로 작업 등록 가능
- [x] **선택된 날짜 자동 적용** - 클릭한 날짜가 기본값으로 설정
- [x] **작업 등록 후 즉시 반영** - 새 작업이 바로 화면에 표시

---

## 📊 Phase 4: 영농일지 통합 관리 (완료 ✅)

### 4.1 캘린더 페이지 연동
- [x] **월별 뷰 통합** - 영농일지에서 작업 데이터 표시
- [x] **이랑별 작업 표시** - 농장의 이랑 번호에 따른 작업 배치
- [x] **환경별 필터링** - 노지/시설1/시설2 환경 구분 표시
- [x] **연속 작업 표시** - 여러 날에 걸친 작업의 연속성 표현
- [x] **반기 뷰 시스템** - 6개월 단위 작물 관리 달력 표시

### 4.2 작업 데이터 시각화
- [x] **작물별 색상 구분** - 작물 종류에 따른 색상 코딩
- [x] **작업 기간 표시** - 시작일부터 종료일까지의 기간 시각화
- [x] **작업 밀도 표시** - 같은 날 여러 작업이 있을 때 밀도 표시
- [x] **오늘 날짜 강조** - 현재 날짜에 대한 시각적 강조
- [x] **커스텀 작물명 연동** - 사용자 정의 작물명(`당근_파종` → `당근`) 자동 추출
- [x] **월별 작업 기간** - 작물별 재배 기간(`10/5-10/10`) 간결 표시

### 4.3 반기 뷰 시스템 (신규 추가 ✨)
- [x] **6개월 단위 표시** - 상반기(1-6월), 하반기(7-12월) 구분 표시
- [x] **스마트 네비게이션** - 반기 간 부드러운 전환 (상반기↔하반기↔다음년도)
- [x] **현재 월 기준 초기화** - 앱 시작 시 현재 달이 포함된 반기 자동 표시
- [x] **가로 공간 최적화** - 12개월 → 6개월로 UI 안정성 및 가독성 향상
- [x] **작물 재배 일정 표시** - 각 월별 작물의 실제 작업 날짜 범위 표시
- [x] **UI 깨짐 방지** - 텍스트 오버플로우 방지 및 반응형 디자인 적용
- [x] **통일된 셀 크기** - 각 월별 고정 너비(w-32) 적용으로 일관된 레이아웃
- [x] **텍스트 크기 최적화** - 작물명 10px, 날짜 8px로 공간 효율성 극대화

### 4.4 통합 데이터 관리
- [x] **실시간 동기화** - 홈에서 등록한 작업이 영농일지에 즉시 반영
- [x] **양방향 편집** - 영농일지에서도 작업 수정/삭제 가능
- [x] **데이터 일관성** - 모든 화면에서 동일한 데이터 표시

---

## 🧮 Phase 5: 작업 계산기 및 자동화 (완료 ✅)

### 5.1 작업 계산기
- [x] **작물별 작업 단계** - 파종부터 수확까지 단계별 작업 자동 계산
- [x] **날짜 간격 계산** - 각 작업 단계별 권장 일수 자동 계산
- [x] **작업 일정 생성** - 기본 날짜 기준으로 전체 일정 자동 생성
- [x] **사용자 커스터마이징** - 필요한 작업만 선택하여 등록
- [x] **작물 정보 백업 시스템** - 농작업 계산기 사용 시 작물 정보 보호 및 복원
- [x] **작물명 일관성 보장** - customCropName과 cropSearchTerm을 활용한 정확한 작물명 표시
- [ ] **생육기간 자동 설정** - registration 데이터의 생육기간 정보를 총 소요기간으로 자동 설정 (제안됨)

### 5.2 자동 작업 생성
- [x] **일괄 작업 등록** - 계산된 일정을 한번에 여러 작업으로 등록
- [x] **작물 정보 연동** - 선택한 작물의 정보를 자동으로 작업에 연결
- [x] **농장 정보 적용** - 농장의 이랑 수와 환경 정보 자동 적용
- [x] **이랑 번호 연동** - 농작업 계산기에서도 선택된 이랑 번호 정보 유지
- [x] **종료 날짜 자동 설정** - 생성되는 모든 작업에 종료 날짜 자동 설정

---

## 🔐 Phase 6: 보안 및 데이터 관리 (완료 ✅)

### 6.1 사용자 인증 및 보안
- [x] **Google OAuth 연동** - Google 계정을 통한 안전한 로그인
- [x] **사용자별 데이터 분리** - RLS를 통한 데이터 격리
- [x] **세션 관리** - 로그인 상태 유지 및 자동 로그아웃
- [x] **권한 검증** - 사용자는 자신의 데이터만 접근 가능

### 6.2 데이터 백업 및 동기화
- [x] **실시간 동기화** - 모든 작업이 즉시 클라우드에 저장
- [x] **데이터 백업** - Supabase 자동 백업 시스템 활용
- [x] **오프라인 지원** - 네트워크 복구 시 자동 동기화
- [x] **데이터 무결성** - 중복 데이터 방지 및 데이터 검증

### 6.3 작업 데이터 Supabase 연동 (완료 ✅)
- [x] **작업 데이터 Supabase 저장** - tasks_v1 테이블을 통한 클라우드 저장
- [x] **계정별 작업 데이터 분리** - 다른 계정으로 로그인 시 작업 데이터 격리 보장
- [x] **RLS 보안 정책** - tasks_v1 테이블에 Row Level Security 적용
- [x] **실시간 작업 동기화** - 작업 등록/수정/삭제가 즉시 클라우드에 반영

---

## 🎨 Phase 7: 사용자 경험 개선 (부분 완료 ⚠️)

### 7.1 UI/UX 개선
- [x] **직관적인 인터페이스** - 사용자가 쉽게 이해할 수 있는 디자인
- [x] **반응형 디자인** - 모바일과 데스크톱 모두 지원
- [x] **로딩 상태 표시** - 데이터 로딩 중 사용자 피드백
- [x] **에러 처리** - 명확한 에러 메시지 및 복구 방법 안내
- [x] **작업 수정 다이얼로그 오류 해결** - edit-task-dialog.tsx 컴포넌트 오류 수정
- [x] **작업 수정 화면 UI 개선** - 취소 버튼 제거, 삭제/수정 완료 버튼만 표시로 깔끔한 UI
- [x] **작물 정보 일관성 보장** - 모든 등록 방식(개별/일괄/농작업 계산기)에서 작물명 통일
- [x] **이랑 번호 연동 개선** - 수정 모드에서 등록된 이랑 번호가 올바르게 표시
- [x] **농장 정보 연동 개선** - 수정 모드에서 등록된 농장 정보가 올바르게 표시
- [x] **종료 날짜 자동 설정** - 일괄등록 시 종료 날짜를 시작 날짜와 동일하게 자동 설정
- [ ] **다크 모드 지원** - 사용자 선호도에 따른 테마 변경 (미구현)
- [ ] **키보드 단축키** - 빠른 작업을 위한 키보드 지원 (미구현)

### 7.2 성능 최적화
- [x] **데이터 캐싱** - React Query를 통한 효율적인 데이터 관리
- [x] **지연 로딩** - 필요할 때만 데이터 로드
- [x] **중복 요청 방지** - 동일한 요청에 대한 중복 처리 방지
- [x] **SQL 파일 정리** - 불필요한 SQL 파일들 삭제로 프로젝트 정리
- [ ] **이미지 최적화** - 작물 이미지 압축 및 지연 로딩 (미구현)
- [ ] **번들 크기 최적화** - 불필요한 코드 제거 및 코드 스플리팅 (미구현)

---

## 📱 Phase 8: 고급 기능 및 확장성 (예정 📋)

### 8.1 알림 및 리마인더
- [ ] **작업 알림** - 예정된 작업에 대한 푸시 알림
- [ ] **이메일 리마인더** - 작업 전날 이메일 알림
- [ ] **알림 설정** - 사용자별 알림 선호도 설정
- [ ] **반복 작업** - 정기적으로 반복되는 작업 자동 생성

### 8.2 데이터 분석 및 리포트
- [ ] **작업 통계** - 월별/연별 작업 완료율 분석
- [ ] **작물별 성과 분석** - 작물별 작업 패턴 및 결과 분석
- [ ] **생산성 리포트** - 농장 운영 효율성 분석

### 8.3 협업 및 공유 기능
- [ ] **팀 작업 관리** - 여러 사용자가 같은 농장 관리
- [ ] **작업 공유** - 작업 계획을 다른 사용자와 공유
- [ ] **댓글 시스템** - 작업에 대한 피드백 및 소통
- [ ] **작업 히스토리** - 작업 변경 이력 추적

---

## 🚀 최근 개선사항 (2025년 1월)

### 작업 등록 및 수정 시스템 개선
- [x] **작물 정보 일관성 보장** - 개별등록, 일괄등록, 농작업 계산기에서 동일한 작물명 표시
- [x] **이랑 번호 연동 개선** - 수정 모드에서 등록된 이랑 번호가 올바르게 표시되지 않는 문제 해결
- [x] **농장 정보 연동 개선** - 수정 모드에서 등록된 농장 정보가 올바르게 표시되지 않는 문제 해결
- [x] **종료 날짜 자동 설정** - 일괄등록 시 종료 날짜가 없어서 캘린더 연동이 안 되는 문제 해결
- [x] **데이터 타입 호환성** - farmId와 cropId의 UUID 문자열 처리로 NaN 오류 해결

### 농작업 계산기 시스템 개선
- [x] **작물 정보 백업 시스템** - 농작업 계산기 사용 시 작물 정보가 초기화되는 문제 해결
- [x] **작물명 일관성** - "작물_파종" 대신 "미니양배추 > 디아라_파종"으로 정확한 작물명 표시
- [x] **이랑 번호 전달** - 농작업 계산기에서도 선택된 이랑 번호 정보 유지

### UI/UX 개선
- [x] **작업 수정 화면 정리** - 취소 버튼 제거로 더 깔끔한 인터페이스 제공
- [x] **버튼 레이아웃 최적화** - 삭제/수정 완료 버튼만 표시로 사용자 경험 개선
- [x] **제목 자동 생성** - 작물명_작업타입 형식으로 일관된 제목 생성

### 디버깅 및 모니터링
- [x] **상세한 로깅 시스템** - 작물 정보 처리 과정을 단계별로 추적 가능
- [x] **에러 추적 개선** - 각 등록 방식별 문제점을 정확히 파악하고 해결
- [x] **데이터 흐름 최적화** - 폼 데이터와 상태 관리 간의 동기화 개선

---

## 🎯 추가 개선사항 (2025년 10월)

### 일괄등록 기능 개선
- [x] **삭제 버튼 추가** - 일괄등록 수정 창에서 취소 → 삭제로 변경 (PR #46)
- [x] **수정 반영 버그 수정** - 일괄 등록 작업 수정 시 변경사항이 즉시 반영되도록 수정
- [x] **날짜 조정 기능 추가** - 농작업 계산기에서 세부 날짜를 개별적으로 조정 가능 (142줄 추가)

### 캘린더 기능 추가
- [x] **CSV Export 기능** - 캘린더 데이터를 CSV 파일로 내보내기 (PR #38)
- [x] **연간 캘린더 버그 수정** - 연간 뷰 표시 오류 해결 (PR #40)

### 추천 시스템 개선
- [x] **추천 정렬 로직 개선** - 점수 동일 시 예상 매출액 기준 2차 정렬 추가
- [x] **Edge Function 재배포** - 개선된 추천 로직 배포

### UI/UX 전반적 개선
- [x] **max-w-md 제거** - 불필요한 최대 너비 제한 제거로 화면 공간 효율적 활용
- [x] **LoginPage 리팩토링** - 코드 일관성 및 가독성 향상
- [x] **Layout 컴포넌트 표준화** - import 문 표준화 및 스타일 정리

### 배포 환경 최적화
- [x] **.env 파일 수정** - 환경 변수 설정 최적화
- [x] **Vercel 배포 설정 개선** - 배포 오류 해결 및 자동화 개선 (PR #41, #42, #43)

### 관련 PR 목록
- #46: 일괄등록 개선 (삭제 버튼, 수정 반영, 날짜 조정)
- #44: 농작업 계산기 로직 재수정
- #43, #42, #41: Vercel 배포 최적화
- #40: 연간 캘린더 수정
- #38: CSV Export 기능 추가

---

## 🔮 제안된 개선사항 (2025년 10월)

### 농작업 계산기 스마트 자동화 (제안됨 💡)
- [ ] **생육기간 자동 설정** - registration 데이터와 연동하여 작물별 생육기간 자동 적용
  - **목표**: 사용자가 매번 생육기간을 입력하지 않고도 정확한 작업 일정을 생성할 수 있도록 함
  - **구현 방법**:
    1. 농작업 계산기 열릴 때 선택된 작물 정보(category, name, variety) 확인
    2. registration 데이터에서 일치하는 작물의 생육기간 찾기
    3. 생육기간을 총 소요기간으로 자동 설정 (기본값 70일 대신)
    4. 생육기간이 없는 경우 기본값 70일 유지
  - **사용자 경험**: 
    - 작물 선택 → 농작업 계산기 열기 → 생육기간 자동 입력됨 → 필요시 수동 조정 가능
  - **기대 효과**: 
    - 정확한 생육기간 정보 제공으로 재배 계획의 정확도 향상
    - 사용자의 입력 부담 감소
    - registration 데이터의 실질적 활용도 증가
  - **기술 구현**:
    ```typescript
    // work-calculator-dialog.tsx
    import { registrationData } from "@/shared/data/registration";
    
    // 작물 정보 매칭 알고리즘
    const matchedCrop = registrationData.find(reg => {
      const categoryMatch = reg.대분류.toLowerCase().includes(selectedCrop.category.toLowerCase());
      const nameMatch = reg.품목.toLowerCase().includes(selectedCrop.name.toLowerCase());
      const varietyMatch = reg.품종.toLowerCase().includes(selectedCrop.variety.toLowerCase());
      return categoryMatch && nameMatch && varietyMatch;
    });
    
    // 생육기간 자동 설정
    const initialDuration = matchedCrop?.생육기간 || 70;
    ```
  - **우선순위**: Medium (사용자 편의성 향상)
  - **예상 소요 시간**: 2-3 시간

---

## 🔧 기술 스택 및 구현 현황

### Frontend
- [x] **React 18** - 최신 React 기능 활용
- [x] **TypeScript** - 타입 안전성 보장
- [x] **Tailwind CSS** - 반응형 스타일링
- [x] **React Query** - 서버 상태 관리
- [x] **React Hook Form** - 폼 관리 및 검증
- [x] **Zod** - 스키마 검증

### Backend & Database
- [x] **Supabase** - 클라우드 데이터베이스
- [x] **PostgreSQL** - 관계형 데이터베이스
- [x] **Row Level Security (RLS)** - 사용자별 데이터 보안
- [x] **Real-time Subscriptions** - 실시간 데이터 동기화

### Authentication
- [x] **Google OAuth 2.0** - 소셜 로그인
- [x] **Supabase Auth** - 인증 관리
- [x] **JWT 토큰** - 세션 관리


### 기술적 지표
- [x] **데이터 동기화 속도** - 작업 저장 후 화면 반영 시간 (실시간 동기화 구현)
- [x] **에러 발생률** - 작업 등록/수정/삭제 시 에러 발생 비율 (오류 해결 완료)
- [x] **페이지 로딩 속도** - 홈 화면 및 캘린더 로딩 시간 (React Query 캐싱 적용)
- [x] **데이터 백업 성공률** - Supabase 자동 백업 시스템 활용
- [x] **작물 정보 일관성** - 모든 등록 방식에서 작물명 표시 정확도 100%
- [x] **이랑 번호 연동률** - 수정 모드에서 이랑 번호 표시 정확도 100%
- [x] **농장 정보 연동률** - 수정 모드에서 농장 정보 표시 정확도 100%
- [x] **UI 응답성** - 버튼 클릭 후 화면 업데이트 시간 최적화


