# PRD: ìº˜ë¦°ë” ê³µìœ  ê¸°ëŠ¥ ê°œì„  ë° ê¶Œí•œ ì œì–´ ê°•í™”

## ğŸ“‹ ê°œìš”

### ëª©ì 
ìº˜ë¦°ë” ê³µìœ  ê¸°ëŠ¥ì„ ê°œì„ í•˜ì—¬ ë†ì¥ê³¼ ì‘ì—… ì •ë³´ê°€ ì˜¬ë°”ë¥´ê²Œ ê³µìœ ë˜ê³ , ì‚¬ìš©ìë³„ ê¶Œí•œì— ë”°ë¼ ì ì ˆí•œ ê¸°ëŠ¥ ì ‘ê·¼ì´ ì œì–´ë˜ë„ë¡ í•©ë‹ˆë‹¤.

### ë°°ê²½
ê¸°ì¡´ ìº˜ë¦°ë” ê³µìœ  ê¸°ëŠ¥ì—ì„œ ë‹¤ìŒê³¼ ê°™ì€ ê°œì„ ì´ í•„ìš”í–ˆìŠµë‹ˆë‹¤:
- ìº˜ë¦°ë” ê³µìœ  ì‹œ í•´ë‹¹ ë†ì¥ê³¼ ì‘ì—… ì •ë³´ê°€ ê³µìœ  ì‚¬ìš©ìì—ê²Œ í‘œì‹œë˜ì–´ì•¼ í•¨
- ì‘ë¬¼ì€ ê°œì¸ ì •ë³´ì´ë¯€ë¡œ ê³µìœ ë˜ì§€ ì•Šì•„ì•¼ í•¨
- ì†Œìœ ì£¼ëŠ” ê³µìœ ë°›ì€ ì‚¬ìš©ìê°€ ë“±ë¡í•œ ì‘ì—…ë„ ìë™ìœ¼ë¡œ í™•ì¸ ê°€ëŠ¥í•´ì•¼ í•¨
- ê¶Œí•œë³„ ê¸°ëŠ¥ ì ‘ê·¼ ì œì–´ê°€ ëª…í™•í•´ì•¼ í•¨

---

## ğŸ¯ í•µì‹¬ ê¸°ëŠ¥

### 1. ë†ì¥ ë° ì‘ì—… ì •ë³´ ê³µìœ 

#### 1.1 ë†ì¥ ê³µìœ 
- ìº˜ë¦°ë”ë¥¼ ê³µìœ í•˜ë©´ í•´ë‹¹ ë†ì¥ ì •ë³´ê°€ ê³µìœ  ì‚¬ìš©ìì—ê²Œ í‘œì‹œë¨
- ê³µìœ ë°›ì€ ë†ì¥ì€ "ì¹œêµ¬ ë†ì¥" ì„¹ì…˜ì— í‘œì‹œë¨
- í‘œì‹œë˜ëŠ” ì •ë³´:
  - ë†ì¥ ì´ë¦„
  - ë†ì¥ ê°œìˆ˜
  - ë†ì¥ ë©´ì  (ã¡)
  - ì´ë‘ ê°œìˆ˜
  - ì‘ë¬¼ ì¢…ë¥˜ ìˆ˜

#### 1.2 ì‘ì—… ì •ë³´ ê³µìœ 
- ê³µìœ ë°›ì€ ë†ì¥ì˜ ëª¨ë“  ì‘ì—…ì´ ê³µìœ  ì‚¬ìš©ìì—ê²Œ í‘œì‹œë¨
- ì†Œìœ ì£¼ëŠ” ê³µìœ ë°›ì€ ì‚¬ìš©ìê°€ ë“±ë¡í•œ ì‘ì—…ë„ ìë™ìœ¼ë¡œ í™•ì¸ ê°€ëŠ¥
- ì‘ì—… ì •ë³´ í¬í•¨:
  - ì‘ì—… ì œëª©
  - ì‘ì—… ìœ í˜•
  - ì˜ˆì • ì¼ì •
  - ì™„ë£Œ ìƒíƒœ

### 2. ì‘ë¬¼ ì •ë³´ ë¹„ê³µìœ 
- ì‘ë¬¼ì€ ê°œì¸ ì •ë³´ì´ë¯€ë¡œ ì ˆëŒ€ ê³µìœ ë˜ì§€ ì•ŠìŒ
- ê³µìœ ë°›ì€ ì‚¬ìš©ìëŠ” ìì‹ ì´ ì¶”ê°€í•œ ì‘ë¬¼ë§Œ "ë‚´ ì‘ë¬¼ ê´€ë¦¬"ì— í‘œì‹œë¨
- íƒ€ì¸ì˜ ì‘ë¬¼ ì •ë³´ëŠ” ì ˆëŒ€ ì ‘ê·¼ ë¶ˆê°€

### 3. ê¶Œí•œë³„ ê¸°ëŠ¥ ì œì–´

#### 3.1 ì „ì²´ ê¶Œí•œ í—ˆìš© (Editor)
- âœ… ì‘ì—… ì¡°íšŒ
- âœ… ì‘ì—… ë“±ë¡
- âœ… ì‘ì—… ìˆ˜ì • (ë³¸ì¸ì´ ë“±ë¡í•œ ì‘ì—…ë§Œ)
- âœ… ì‘ì—… ì‚­ì œ (ë³¸ì¸ì´ ë“±ë¡í•œ ì‘ì—…ë§Œ)
- âœ… ì‘ì—… ì™„ë£Œ ìƒíƒœ ë³€ê²½ (ë³¸ì¸ì´ ë“±ë¡í•œ ì‘ì—…ë§Œ)
- âœ… Todo-List í‘œì‹œ

#### 3.2 ëŒ“ê¸€ í—ˆìš© (Commenter)
- âœ… ì‘ì—… ì¡°íšŒ
- âŒ ì‘ì—… ë“±ë¡
- âŒ ì‘ì—… ìˆ˜ì •
- âŒ ì‘ì—… ì‚­ì œ
- âŒ ì‘ì—… ì™„ë£Œ ìƒíƒœ ë³€ê²½
- âŒ Todo-List í‘œì‹œ (í˜„ì¬ ë¯¸êµ¬í˜„ ìƒíƒœì™€ ë™ì¼)

#### 3.3 ì½ê¸° í—ˆìš© (Viewer)
- âœ… ì‘ì—… ì¡°íšŒ
- âŒ ì‘ì—… ë“±ë¡
- âŒ ì‘ì—… ìˆ˜ì •
- âŒ ì‘ì—… ì‚­ì œ
- âŒ ì‘ì—… ì™„ë£Œ ìƒíƒœ ë³€ê²½
- âŒ Todo-List í‘œì‹œ
- ëª¨ë“  í¸ì§‘ ë²„íŠ¼ ë¹„í™œì„±í™” ë° íˆ´íŒ í‘œì‹œ

### 4. ì†Œìœ ì£¼ ê¶Œí•œ
- ì†Œìœ ì£¼ëŠ” ìì‹ ì˜ ë†ì¥ì—ì„œ ë“±ë¡ëœ ëª¨ë“  ì‘ì—…ì„ í™•ì¸ ê°€ëŠ¥
- ê³µìœ ë°›ì€ ì‚¬ìš©ìê°€ ë“±ë¡í•œ ì‘ì—…ë„ ìë™ìœ¼ë¡œ í‘œì‹œë¨
- ê³µìœ  ì„¤ì • ë‹¤ì´ì–¼ë¡œê·¸ì—ì„œ ì†Œìœ ì£¼ê°€ ìƒë‹¨ì— ë³„ë„ë¡œ í‘œì‹œë¨
- ì†Œìœ ì£¼ëŠ” í•­ìƒ "ì†Œìœ ì£¼" ë°°ì§€ë¡œ í‘œì‹œë¨

---

## ğŸ“ ê¸°ìˆ  ìŠ¤í™

### Database ë³€ê²½ì‚¬í•­

#### 1. RLS ì •ì±… ê°œì„ 
**íŒŒì¼**: `supabase/migrations/add_shared_calendar_rls_policies.sql`

##### 1.1 Farms í…Œì´ë¸”
```sql
-- ì†Œìœ ì£¼ëŠ” ìì‹ ì˜ ë†ì¥ ì¡°íšŒ ê°€ëŠ¥
CREATE POLICY "Users can view own farms"
ON farms FOR SELECT
USING (user_id::text = auth.uid()::text);

-- ê³µìœ ë°›ì€ ì‚¬ìš©ìëŠ” ê³µìœ ë°›ì€ ë†ì¥ ì¡°íšŒ ê°€ëŠ¥
CREATE POLICY "Users can view shared farms"
ON farms FOR SELECT
USING (
  EXISTS (
    SELECT 1 FROM calendar_shares cs
    WHERE cs.calendar_id::text = farms.id::text
    AND cs.shared_user_id::text = auth.uid()::text
  )
);
```

##### 1.2 Tasks_v1 í…Œì´ë¸”
```sql
-- ìì‹ ì´ ë“±ë¡í•œ ì‘ì—… ì¡°íšŒ
CREATE POLICY "Users can view own tasks v1"
ON tasks_v1 FOR SELECT
USING (user_id::text = auth.uid()::text);

-- ê³µìœ ë°›ì€ ë†ì¥ì˜ ëª¨ë“  ì‘ì—… ì¡°íšŒ
CREATE POLICY "Users can view shared tasks v1"
ON tasks_v1 FOR SELECT
USING (
  EXISTS (
    SELECT 1 FROM calendar_shares cs
    INNER JOIN farms f ON cs.calendar_id::text = f.id::text
    WHERE f.id::text = tasks_v1.farm_id::text
    AND cs.shared_user_id::text = auth.uid()::text
  )
);

-- ì†Œìœ ì£¼ëŠ” ìì‹ ì˜ ë†ì¥ì˜ ëª¨ë“  ì‘ì—… ì¡°íšŒ ê°€ëŠ¥
CREATE POLICY "Users can view farm owner tasks v1"
ON tasks_v1 FOR SELECT
USING (
  EXISTS (
    SELECT 1 FROM farms f
    WHERE f.id::text = tasks_v1.farm_id::text
    AND f.user_id::text = auth.uid()::text
  )
);

-- ì‘ì—… ë“±ë¡: ì†Œìœ ì£¼ ë˜ëŠ” editor ê¶Œí•œë§Œ ê°€ëŠ¥
CREATE POLICY "Users can insert own tasks v1"
ON tasks_v1 FOR INSERT
WITH CHECK (
  user_id::text = auth.uid()::text
  AND (
    EXISTS (
      SELECT 1 FROM farms f
      WHERE f.id::text = tasks_v1.farm_id::text
      AND f.user_id::text = auth.uid()::text
    )
    OR EXISTS (
      SELECT 1 FROM calendar_shares cs
      INNER JOIN farms f ON cs.calendar_id::text = f.id::text
      WHERE f.id::text = tasks_v1.farm_id::text
      AND cs.shared_user_id::text = auth.uid()::text
      AND cs.role = 'editor'
    )
  )
);

-- ì‘ì—… ìˆ˜ì •: ì†Œìœ ì£¼ ë˜ëŠ” editor ê¶Œí•œì´ë©´ì„œ ë³¸ì¸ì´ ë“±ë¡í•œ ì‘ì—…ë§Œ
CREATE POLICY "Users can update own tasks v1"
ON tasks_v1 FOR UPDATE
USING (
  user_id::text = auth.uid()::text
  AND (
    EXISTS (
      SELECT 1 FROM farms f
      WHERE f.id::text = tasks_v1.farm_id::text
      AND f.user_id::text = auth.uid()::text
    )
    OR EXISTS (
      SELECT 1 FROM calendar_shares cs
      INNER JOIN farms f ON cs.calendar_id::text = f.id::text
      WHERE f.id::text = tasks_v1.farm_id::text
      AND cs.shared_user_id::text = auth.uid()::text
      AND cs.role = 'editor'
    )
  )
);

-- ì‘ì—… ì‚­ì œ: ì†Œìœ ì£¼ ë˜ëŠ” editor ê¶Œí•œì´ë©´ì„œ ë³¸ì¸ì´ ë“±ë¡í•œ ì‘ì—…ë§Œ
CREATE POLICY "Users can delete own tasks v1"
ON tasks_v1 FOR DELETE
USING (
  user_id::text = auth.uid()::text
  AND (
    EXISTS (
      SELECT 1 FROM farms f
      WHERE f.id::text = tasks_v1.farm_id::text
      AND f.user_id::text = auth.uid()::text
    )
    OR EXISTS (
      SELECT 1 FROM calendar_shares cs
      INNER JOIN farms f ON cs.calendar_id::text = f.id::text
      WHERE f.id::text = tasks_v1.farm_id::text
      AND cs.shared_user_id::text = auth.uid()::text
      AND cs.role = 'editor'
    )
  )
);
```

##### 1.3 Crops í…Œì´ë¸”
```sql
-- ì‘ë¬¼ì€ ì ˆëŒ€ ê³µìœ ë˜ì§€ ì•ŠìŒ - ë³¸ì¸ì˜ ì‘ë¬¼ë§Œ ì¡°íšŒ ê°€ëŠ¥
CREATE POLICY "Users can view own crops"
ON crops FOR SELECT
USING (user_id::text = auth.uid()::text);
```

**ì¤‘ìš”**: `CREATE POLICY "Users can view shared crops"` ì •ì±…ì€ ì œê±°ë¨

#### 2. API ë ˆë²¨ ì¶”ê°€ í•„í„°ë§

**íŒŒì¼**: `src/shared/api/crop.repository.ts`

```typescript
async listByFarm(farmId?: string): Promise<CropEntity[]> {
  const userId = await this.withUserId()
  // ì‘ë¬¼ì€ ì ˆëŒ€ ê³µìœ ë˜ì§€ ì•ŠìŒ - ë³¸ì¸ì˜ ì‘ë¬¼ë§Œ ì¡°íšŒ
  let q = this.supabase
    .from('crops')
    .select('*')
    .eq('user_id', userId) // ëª…ì‹œì ìœ¼ë¡œ ë³¸ì¸ì˜ ì‘ë¬¼ë§Œ í•„í„°ë§
  if (farmId) q = q.eq('farm_id', farmId)
  const { data, error } = await q.order('created_at', { ascending: false })
  // ...
}
```

### 3. í”„ë¡ íŠ¸ì—”ë“œ ê¶Œí•œ í™•ì¸

#### 3.1 ê¶Œí•œ í™•ì¸ í›…
**íŒŒì¼**: `src/features/calendar-share/model/calendar-share.hooks.ts`

```typescript
// ë†ì¥ì˜ ì†Œìœ ì£¼ ì¡°íšŒ
export const useFarmOwner = (farmId: string) => {
  return useQuery<SharedUser | null>({
    queryKey: ["/api/farm-owner", farmId],
    queryFn: () => calendarShareApi.getFarmOwner(farmId),
    enabled: !!farmId,
  });
};

// ì‚¬ìš©ìì˜ ë†ì¥ë³„ ê¶Œí•œ í™•ì¸
export const useUserRoleForCalendar = (calendarId: string) => {
  return useQuery<UserRole>({
    queryKey: ["/api/user-role", calendarId],
    queryFn: () => calendarShareApi.getUserRoleForCalendar(calendarId),
    enabled: !!calendarId,
  });
};

// ì—¬ëŸ¬ ë†ì¥ì˜ ê³µìœ  ì—¬ë¶€ í™•ì¸
export const useSharedFarmIds = (farmIds: string[]) => {
  return useQuery<Set<string>>({
    queryKey: ["/api/shared-farm-ids", farmIds.sort().join(",")],
    queryFn: () => calendarShareApi.getSharedFarmIds(farmIds),
    enabled: farmIds.length > 0,
  });
};

// ì—¬ëŸ¬ ë†ì¥ì˜ ì†Œìœ ì£¼ ì •ë³´ ì¡°íšŒ
export const useFarmOwners = (farmIds: string[]) => {
  return useQuery<Map<string, SharedUser>>({
    queryKey: ["/api/farm-owners", farmIds.sort().join(",")],
    queryFn: () => calendarShareApi.getFarmOwners(farmIds),
    enabled: farmIds.length > 0,
  });
};
```

#### 3.2 UI ê¶Œí•œ ì œì–´

##### Farm Calendar Grid
**íŒŒì¼**: `src/components/farm-calendar-grid.tsx`

```typescript
// ê¶Œí•œ í™•ì¸
const { data: userRole } = useUserRoleForCalendar(selectedFarm?.id || "");
const canEditTask = selectedFarm 
  ? (selectedFarm.userId === user?.id || userRole === 'editor')
  : true;

// ì‘ì—… ì¶”ê°€ ë²„íŠ¼ ë¹„í™œì„±í™”
<Button 
  disabled={!canEditTask}
  title={!canEditTask ? "ì½ê¸° ê¶Œí•œë§Œ ìˆì–´ ì‘ì—…ì„ ì¶”ê°€í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤" : ""}
>
  ì‘ì—… ì¶”ê°€
</Button>

// ì‘ì—… ìˆ˜ì • ë²„íŠ¼ ë¹„í™œì„±í™”
<Button 
  disabled={!canEditTask || task.userId !== user?.id}
  title={!canEditTask ? "ì½ê¸° ê¶Œí•œë§Œ ìˆì–´ ì‘ì—…ì„ ìˆ˜ì •í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤" : ...}
>
  ìˆ˜ì •
</Button>
```

##### Add Task Dialog
**íŒŒì¼**: `src/components/add-task-dialog-improved.tsx`

```typescript
// ê¶Œí•œ í™•ì¸
const canEditTask = taskFarmId && farms 
  ? (() => {
      const farm = farms.find(f => f.id === taskFarmId);
      return farm ? (farm.userId === user?.id || userRole === 'editor') : true;
    })()
  : true;

// ì‚­ì œ ë²„íŠ¼ ë¹„í™œì„±í™”
<Button
  disabled={deleteMutation.isPending || !canEditTask || task.userId !== user?.id}
  title={!canEditTask ? "ì½ê¸° ê¶Œí•œë§Œ ìˆì–´ ì‘ì—…ì„ ì‚­ì œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤" : ...}
>
  ì‚­ì œ
</Button>

// ìˆ˜ì • ì™„ë£Œ ë²„íŠ¼ ë¹„í™œì„±í™”
<Button
  disabled={... || (task && (!canEditTask || task.userId !== user?.id))}
  title={task && !canEditTask ? "ì½ê¸° ê¶Œí•œë§Œ ìˆì–´ ì‘ì—…ì„ ìˆ˜ì •í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤" : ...}
>
  ìˆ˜ì • ì™„ë£Œ
</Button>
```

##### Todo List
**íŒŒì¼**: `src/components/todo-list.tsx`

```typescript
// ì™„ë£Œ ì²´í¬ë°•ìŠ¤ ë¹„í™œì„±í™”
const canEditTask = (task: TodoItem): boolean => {
  if (!task.farmId || !farms) return true;
  const farm = farms.find(f => f.id === task.farmId);
  if (!farm) return true;
  if (farm.userId === user?.id) return true;
  return false; // viewerëŠ” ì™„ë£Œ ìƒíƒœ ë³€ê²½ ë¶ˆê°€
};

<div 
  className={`... ${canEditTask(task) && task.userId === user?.id 
    ? "cursor-pointer" 
    : "cursor-not-allowed opacity-50"}`}
  onClick={(e) => {
    if (canEditTask(task) && task.userId === user?.id) {
      handleTaskToggle(task, e);
    }
  }}
>
```

---

## ğŸ¨ UI/UX ê°œì„ ì‚¬í•­

### 1. ê³µìœ  ì„¤ì • ë‹¤ì´ì–¼ë¡œê·¸
**íŒŒì¼**: `src/features/calendar-share/ui/CalendarShareDialog.tsx`

#### 1.1 ì†Œìœ ì£¼ í‘œì‹œ
- ì†Œìœ ì£¼ëŠ” ë³„ë„ì˜ ë…¸ë€ìƒ‰ ì¹´ë“œë¡œ ìƒë‹¨ì— í‘œì‹œ
- í¬ë¼ìš´ ì•„ì´ì½˜ê³¼ "ì†Œìœ ì£¼" ë°°ì§€ í‘œì‹œ
- ê³µìœ ë°›ì€ ì‚¬ìš©ì ë¦¬ìŠ¤íŠ¸ ìœ„ì— í•­ìƒ í‘œì‹œ

```tsx
{farmOwner && (
  <div className="border-2 border-amber-200 rounded-lg p-3 bg-amber-50/50">
    <Avatar className="ring-2 ring-amber-400">
      <AvatarFallback className="bg-amber-100 text-amber-700">
        <Crown className="w-4 h-4" />
      </AvatarFallback>
    </Avatar>
    <div>
      <p>{farmOwner.email}</p>
      {farmOwner.displayName && <p>{farmOwner.displayName}</p>}
    </div>
    <Badge className="bg-amber-50 text-amber-700 border-amber-300">
      ì†Œìœ ì£¼
    </Badge>
  </div>
)}
```

### 2. ë†ì¥ ëª©ë¡ í˜ì´ì§€
**íŒŒì¼**: `src/pages/farms/ui/FarmsPage.tsx`

#### 2.1 ë‚´ ë†ì¥ ëª©ë¡
- ê³µìœ ë˜ê³  ìˆëŠ” ë†ì¥ì€ íŒŒë€ìƒ‰ ë°°ê²½ìœ¼ë¡œ í‘œì‹œ
- íŒŒë€ìƒ‰ ì•„ì´ì½˜ìœ¼ë¡œ ì‹œê°ì  êµ¬ë¶„

```tsx
<Card className={isShared ? "border-blue-200 bg-blue-50/30" : ""}>
  <MapPin className={`w-4 h-4 ${isShared ? "text-blue-500" : "text-gray-500"}`} />
  <h3>{farm.name}</h3>
</Card>
```

#### 2.2 ì¹œêµ¬ ë†ì¥ ëª©ë¡
- ê³µìœ ë°›ì€ ë†ì¥ì€ íŒŒë€ìƒ‰ ë°°ê²½ìœ¼ë¡œ í‘œì‹œ
- ë†ì¥ ì´ë¦„ ì˜†ì— ì†Œìœ ì£¼ ì´ë¦„ í‘œì‹œ

```tsx
<Card className="border-blue-200 bg-blue-50/30">
  <MapPin className="w-4 h-4 text-blue-500" />
  <h3 className="font-medium text-gray-900">{farm.name}</h3>
  <span className="text-xs text-gray-500">({ownerName})</span>
</Card>
```

---

## âœ… êµ¬í˜„ ì™„ë£Œ ì‚¬í•­

### Database
- [x] RLS ì •ì±… ìˆ˜ì • (farms, tasks_v1, crops)
- [x] ì†Œìœ ì£¼ ì‘ì—… ì¡°íšŒ ì •ì±… ì¶”ê°€
- [x] editorë§Œ ì‘ì—… ë“±ë¡ ê°€ëŠ¥í•˜ë„ë¡ ì •ì±… ìˆ˜ì •
- [x] viewer/commenterëŠ” ì‘ì—… ìˆ˜ì •/ì‚­ì œ ë¶ˆê°€í•˜ë„ë¡ ì •ì±… ìˆ˜ì •
- [x] ì‘ë¬¼ ê³µìœ  ì •ì±… ì œê±°

### API
- [x] `getFarmOwner` í•¨ìˆ˜ ì¶”ê°€
- [x] `getSharedFarmIds` í•¨ìˆ˜ ì¶”ê°€
- [x] `getFarmOwners` í•¨ìˆ˜ ì¶”ê°€
- [x] `CropRepository.listByFarm`ì— ëª…ì‹œì  user_id í•„í„° ì¶”ê°€

### Frontend ê¶Œí•œ í™•ì¸
- [x] `useFarmOwner` í›… ì¶”ê°€
- [x] `useSharedFarmIds` í›… ì¶”ê°€
- [x] `useFarmOwners` í›… ì¶”ê°€
- [x] `useUserRoleForCalendar` í›… í™œìš©

### UI ê¶Œí•œ ì œì–´
- [x] Farm Calendar Grid - ì‘ì—… ì¶”ê°€/ìˆ˜ì • ë²„íŠ¼ ë¹„í™œì„±í™”
- [x] Add Task Dialog - ì‚­ì œ/ìˆ˜ì • ë²„íŠ¼ ë¹„í™œì„±í™”
- [x] Edit Task Dialog - ìˆ˜ì • ë²„íŠ¼ ë¹„í™œì„±í™”
- [x] Todo List - ì™„ë£Œ ì²´í¬ë°•ìŠ¤ ë¹„í™œì„±í™”
- [x] ëª¨ë“  ë¹„í™œì„± ë²„íŠ¼ì— íˆ´íŒ ì¶”ê°€

### UI ê°œì„ 
- [x] ê³µìœ  ì„¤ì • ë‹¤ì´ì–¼ë¡œê·¸ - ì†Œìœ ì£¼ ìƒë‹¨ í‘œì‹œ
- [x] ë†ì¥ ëª©ë¡ - ê³µìœ ëœ ë†ì¥ íŒŒë€ìƒ‰ ë°°ê²½ í‘œì‹œ
- [x] ì¹œêµ¬ ë†ì¥ - ì†Œìœ ì£¼ ì´ë¦„ í‘œì‹œ
- [x] ì¤‘ë³µëœ ì†Œìœ ì£¼ ë°°ì§€ ì œê±°

---

## ğŸ”’ ë³´ì•ˆ ê³ ë ¤ì‚¬í•­

### 1. RLS ì •ì±… ì´ì¤‘ ê²€ì¦
- ë°ì´í„°ë² ì´ìŠ¤ ë ˆë²¨: RLS ì •ì±…ìœ¼ë¡œ ê¸°ë³¸ ë³´ì•ˆ ë³´ì¥
- API ë ˆë²¨: Repositoryì—ì„œ ëª…ì‹œì  í•„í„°ë§ ì¶”ê°€
- í”„ë¡ íŠ¸ì—”ë“œ ë ˆë²¨: UIì—ì„œ ê¶Œí•œ í™•ì¸ í›„ ë²„íŠ¼ ë¹„í™œì„±í™”

### 2. ì‘ë¬¼ ì •ë³´ ë³´í˜¸
- RLS ì •ì±…ì—ì„œ ê³µìœ  ì •ì±… ì œê±°
- API ë ˆë²¨ì—ì„œ ëª…ì‹œì  user_id í•„í„°ë§
- í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ê³µìœ ë°›ì€ ì‘ë¬¼ í‘œì‹œ ì œê±°

### 3. íƒ€ì… ìºìŠ¤íŒ…
- UUIDì™€ TEXT íƒ€ì… ë¶ˆì¼ì¹˜ ë¬¸ì œ í•´ê²°
- ëª¨ë“  RLS ì •ì±…ì—ì„œ `::text` ìºìŠ¤íŒ… ì ìš©

---

## ğŸ“ ì£¼ìš” ë³€ê²½ íŒŒì¼

### Database
- `supabase/migrations/add_shared_calendar_rls_policies.sql`

### API
- `src/shared/api/crop.repository.ts`
- `src/shared/api/calendar-share.repository.ts`
- `src/features/calendar-share/api/calendar-share.api.ts`

### Hooks
- `src/features/calendar-share/model/calendar-share.hooks.ts`

### UI Components
- `src/components/farm-calendar-grid.tsx`
- `src/components/add-task-dialog-improved.tsx`
- `src/components/edit-task-dialog.tsx`
- `src/components/todo-list.tsx`
- `src/features/calendar-share/ui/CalendarShareDialog.tsx`
- `src/pages/farms/ui/FarmsPage.tsx`

---

## ğŸ¯ ì„±ê³µ ì§€í‘œ

### ê¸°ëŠ¥ ì •í™•ì„±
- âœ… ìº˜ë¦°ë” ê³µìœ  ì‹œ ë†ì¥ ì •ë³´ê°€ ì˜¬ë°”ë¥´ê²Œ í‘œì‹œë¨
- âœ… ì‘ì—… ì •ë³´ê°€ ê³µìœ  ì‚¬ìš©ìì—ê²Œ í‘œì‹œë¨
- âœ… ì‘ë¬¼ì€ ì ˆëŒ€ ê³µìœ ë˜ì§€ ì•ŠìŒ
- âœ… ì†Œìœ ì£¼ëŠ” ëª¨ë“  ì‘ì—…ì„ í™•ì¸ ê°€ëŠ¥

### ê¶Œí•œ ì œì–´
- âœ… Viewer ê¶Œí•œì€ ì‘ì—… ì¡°íšŒë§Œ ê°€ëŠ¥
- âœ… Editor ê¶Œí•œì€ ì‘ì—… ë“±ë¡/ìˆ˜ì •/ì‚­ì œ ê°€ëŠ¥ (ë³¸ì¸ ì‘ì—…ë§Œ)
- âœ… ëª¨ë“  í¸ì§‘ ë²„íŠ¼ì´ ê¶Œí•œì— ë”°ë¼ ì ì ˆíˆ ë¹„í™œì„±í™”ë¨
- âœ… ë¹„í™œì„± ë²„íŠ¼ì— ëª…í™•í•œ íˆ´íŒ í‘œì‹œ

### ì‚¬ìš©ì ê²½í—˜
- âœ… ì†Œìœ ì£¼ê°€ ê³µìœ  ì„¤ì •ì—ì„œ ëª…í™•íˆ êµ¬ë¶„ë¨
- âœ… ê³µìœ ëœ ë†ì¥ì´ ì‹œê°ì ìœ¼ë¡œ êµ¬ë¶„ë¨
- âœ… ì†Œìœ ì£¼ ì´ë¦„ì´ ì¹œêµ¬ ë†ì¥ì— í‘œì‹œë¨
- âœ… ê¶Œí•œ ë¶€ì¡± ì‹œ ëª…í™•í•œ ì•ˆë‚´ ë©”ì‹œì§€ í‘œì‹œ

---

## ğŸ“š ê´€ë ¨ ë¬¸ì„œ

- `prd_calendar_share_with_permissions.md` - ê¸°ë³¸ ìº˜ë¦°ë” ê³µìœ  ê¸°ëŠ¥ PRD
- `supabase/migrations/add_shared_calendar_rls_policies.sql` - RLS ì •ì±… êµ¬í˜„

---

## ğŸ”„ í–¥í›„ ê°œì„  ì‚¬í•­

### 1. Todo-List ê¶Œí•œ ì œì–´
- Editor ê¶Œí•œì„ ê°€ì§„ ë†ì¥ì˜ ì‘ì—…ë§Œ Todo-Listì— í‘œì‹œ
- Viewer/Commenter ê¶Œí•œë§Œ ìˆëŠ” ê²½ìš° Todo-List ìˆ¨ê¹€
- **í˜„ì¬**: ì‚¬ìš©ìê°€ í•´ë‹¹ ê¸°ëŠ¥ ì œê±°

### 2. Commenter ê¶Œí•œ ê¸°ëŠ¥
- ëŒ“ê¸€ ê¸°ëŠ¥ êµ¬í˜„
- Commenter ê¶Œí•œìœ¼ë¡œ ëŒ“ê¸€ ì‘ì„± ê°€ëŠ¥í•˜ë„ë¡ í™•ì¥

### 3. ê¶Œí•œ ë³€ê²½ ì•Œë¦¼
- ê¶Œí•œ ë³€ê²½ ì‹œ ì•Œë¦¼ ì „ì†¡
- ì´ë©”ì¼/í‘¸ì‹œ ì•Œë¦¼ ì—°ë™

### 4. ì„±ëŠ¥ ìµœì í™”
- ì—¬ëŸ¬ ë†ì¥ ê¶Œí•œ ì¼ê´„ ì¡°íšŒ ìµœì í™”
- React Query ìºì‹± ì „ëµ ê°œì„ 

